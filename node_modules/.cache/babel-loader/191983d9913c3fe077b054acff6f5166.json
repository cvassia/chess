{"ast":null,"code":"import * as Chess from \"chess.js\";\nimport { BehaviorSubject } from \"rxjs\"; // let promotion = \"rnb2bnr/pppPkppp/8/4p3/7q/8/PPPP1PPP/RNBQKBNR w KQ - 1 5\";\n// let checkmate = \"rnb1kbnr/pppp1ppp/8/4p3/5PPq/8/PPPPP2P/RNBQKBNR w KQkq - 1 3\";\n\nconst chess = new Chess();\nexport const gameSubject = new BehaviorSubject();\nexport function initGame() {\n  const savedGame = localStorage.getItem(\"savedGame\");\n\n  if (savedGame) {\n    chess.load(savedGame);\n  }\n\n  updateGame();\n}\nexport function resetGame() {\n  chess.reset();\n  updateGame();\n}\nexport function handleMove(from, to) {\n  const promotions = chess.moves({\n    verbose: true\n  }).filter(m => m.promotion);\n\n  if (promotions.some(p => `${p.from}:${p.to}` === `${from}:${to}`)) {\n    const pendingPromotion = {\n      from,\n      to,\n      color: promotions[0].color\n    };\n    updateGame(pendingPromotion);\n  }\n\n  const {\n    pendingPromotion\n  } = gameSubject.getValue();\n\n  if (!pendingPromotion) {\n    move(from, to);\n  }\n}\nexport function move(from, to, promotion) {\n  let tempMove = {\n    from,\n    to\n  };\n\n  if (promotion) {\n    tempMove.promotion = promotion;\n  }\n\n  const legalMove = chess.move(tempMove);\n\n  if (legalMove) {\n    updateGame();\n  }\n}\nexport function undoMove() {\n  chess.undo();\n  updateGame();\n}\n\nfunction updateGame(pendingPromotion) {\n  const isGameOver = chess.game_over();\n  const newGame = {\n    board: chess.board(),\n    pendingPromotion,\n    isGameOver,\n    result: isGameOver ? getGameResult() : null\n  };\n  localStorage.setItem(\"savedGame\", chess.fen());\n  gameSubject.next(newGame);\n}\n\nfunction getGameResult() {\n  if (chess.in_checkmate()) {\n    const winner = chess.turn() === \"w\" ? \"black\" : \"white\";\n    return `Checkmate - winner - ${winner}`;\n  } else if (chess.in_draw()) {\n    let reason = \"50 - moves - rule\";\n\n    if (chess.in_stalemate()) {\n      reason = \"Stalemate\";\n    } else if (chess.in_threefold_repetition()) {\n      reason = \"Repetition\";\n    } else if (chess.insufficient_material()) {\n      reason = \"insufficient material\";\n    }\n\n    return `Draw - ${reason}`;\n  } else {\n    return \"unknown reason\";\n  }\n}","map":{"version":3,"sources":["/Users/vassiachrist/Documents/dev/js/react/chess-game/src/components/Game.js"],"names":["Chess","BehaviorSubject","chess","gameSubject","initGame","savedGame","localStorage","getItem","load","updateGame","resetGame","reset","handleMove","from","to","promotions","moves","verbose","filter","m","promotion","some","p","pendingPromotion","color","getValue","move","tempMove","legalMove","undoMove","undo","isGameOver","game_over","newGame","board","result","getGameResult","setItem","fen","next","in_checkmate","winner","turn","in_draw","reason","in_stalemate","in_threefold_repetition","insufficient_material"],"mappings":"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","sourcesContent":["import * as Chess from \"chess.js\";\nimport { BehaviorSubject } from \"rxjs\";\n\n// let promotion = \"rnb2bnr/pppPkppp/8/4p3/7q/8/PPPP1PPP/RNBQKBNR w KQ - 1 5\";\n// let checkmate = \"rnb1kbnr/pppp1ppp/8/4p3/5PPq/8/PPPPP2P/RNBQKBNR w KQkq - 1 3\";\n\nconst chess = new Chess();\n\nexport const gameSubject = new BehaviorSubject();\n\nexport function initGame() {\n  const savedGame = localStorage.getItem(\"savedGame\");\n  if (savedGame) {\n    chess.load(savedGame);\n  }\n  updateGame();\n}\n\nexport function resetGame() {\n  chess.reset();\n  updateGame();\n}\n\nexport function handleMove(from, to) {\n  const promotions = chess.moves({ verbose: true }).filter((m) => m.promotion);\n  if (promotions.some((p) => `${p.from}:${p.to}` === `${from}:${to}`)) {\n    const pendingPromotion = { from, to, color: promotions[0].color };\n    updateGame(pendingPromotion);\n  }\n  const { pendingPromotion } = gameSubject.getValue();\n  if (!pendingPromotion) {\n    move(from, to);\n  }\n}\n\nexport function move(from, to, promotion) {\n  let tempMove = { from, to };\n  if (promotion) {\n    tempMove.promotion = promotion;\n  }\n\n  const legalMove = chess.move(tempMove);\n  if (legalMove) {\n    updateGame();\n  }\n}\n\nexport function undoMove() {\n  chess.undo();\n  updateGame();\n}\n\nfunction updateGame(pendingPromotion) {\n  const isGameOver = chess.game_over();\n  const newGame = {\n    board: chess.board(),\n    pendingPromotion,\n    isGameOver,\n    result: isGameOver ? getGameResult() : null,\n  };\n\n  localStorage.setItem(\"savedGame\", chess.fen());\n\n  gameSubject.next(newGame);\n}\n\nfunction getGameResult() {\n  if (chess.in_checkmate()) {\n    const winner = chess.turn() === \"w\" ? \"black\" : \"white\";\n    return `Checkmate - winner - ${winner}`;\n  } else if (chess.in_draw()) {\n    let reason = \"50 - moves - rule\";\n    if (chess.in_stalemate()) {\n      reason = \"Stalemate\";\n    } else if (chess.in_threefold_repetition()) {\n      reason = \"Repetition\";\n    } else if (chess.insufficient_material()) {\n      reason = \"insufficient material\";\n    }\n    return `Draw - ${reason}`;\n  } else {\n    return \"unknown reason\";\n  }\n}\n"]},"metadata":{},"sourceType":"module"}